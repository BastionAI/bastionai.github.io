<style>
.multi-head-container {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 24px;
    margin: 2em 0;
    background-color: #f9fafb;
}
.multi-head-sentence {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: 24px;
    padding: 16px;
    border-radius: 8px;
    background-color: #fff;
    border: 1px solid #e5e7eb;
    text-align: center;
    line-height: 2;
}
.multi-head-word {
    transition: all 0.2s ease-in-out;
    padding: 4px;
    border-radius: 4px;
}
.multi-head-controls {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 16px;
}
.multi-head-button {
    background-color: #fff;
    border: 1px solid #d1d5db;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.95em;
    transition: all 0.2s;
}
.multi-head-button:hover {
    background-color: #f3f4f6;
    border-color: #9ca3af;
}
.multi-head-button.active {
    background-color: #3b82f6;
    color: white;
    border-color: #3b82f6;
}
</style>

<div class="multi-head-container" role="region" aria-label="Interactive Multi-Head Attention Visualization">
    <div class="multi-head-sentence" id="multi-head-sentence">
        <!-- Spans will be generated by JS -->
    </div>
    <div class="multi-head-controls">
        <p>Click on a "Specialist Head" to see which aspect of the sentence it focuses on:</p>
        <div id="multi-head-buttons">
            <!-- Buttons will be generated by JS -->
        </div>
    </div>
    <noscript>
        <figure>
            <img src="/assets/images/fallbacks/multi-head-fallback.png" alt="Static diagram of Multi-Head Attention. It shows a sentence with different words highlighted, corresponding to different 'specialist heads' that focus on grammar, pronouns, and concepts respectively." style="max-width: 100%; border-radius: 8px; margin-top: 15px;">
            <figcaption style="font-size: 0.9em; color: #666; margin-top: 5px;">
                Static fallback image. This visualization demonstrates how different 'heads' in the attention mechanism focus on different parts of a sentence to build a complete understanding of context.
            </figcaption>
        </figure>
    </noscript>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const sentenceContainer = document.getElementById('multi-head-sentence');
    const buttonsContainer = document.getElementById('multi-head-buttons');
    
    const sentence = "The robot picked up the ball because it was heavy";
    const words = sentence.split(' ');

    const attentionData = {
        'Grammar Expert': { 'robot': '#bfdbfe', 'picked': '#bfdbfe' },
        'Pronoun Resolver': { 'it': '#bfdbfe', 'ball': '#bfdbfe' },
        'Conceptual Linker': { 'picked': '#fee2e2', 'heavy': '#fee2e2' }
    };

    // Populate sentence
    words.forEach(word => {
        const span = document.createElement('span');
        span.className = 'multi-head-word';
        span.dataset.word = word;
        span.textContent = word;
        sentenceContainer.appendChild(span);
        sentenceContainer.appendChild(document.createTextNode(' ')); // Add space
    });
    
    const wordElements = sentenceContainer.querySelectorAll('.multi-head-word');

    // Populate buttons
    Object.keys(attentionData).forEach((headName, index) => {
        const button = document.createElement('button');
        button.className = 'multi-head-button';
        button.dataset.head = headName;
        button.textContent = headName;
        if (index === 0) {
            button.classList.add('active');
        }
        buttonsContainer.appendChild(button);
    });

    const buttons = buttonsContainer.querySelectorAll('.multi-head-button');

    function updateHighlight(headName) {
        wordElements.forEach(wordEl => {
            wordEl.style.backgroundColor = 'transparent';
        });

        const highlights = attentionData[headName];
        if (!highlights) return;

        for (const word in highlights) {
            const color = highlights[word];
            const wordEl = sentenceContainer.querySelector(`.multi-head-word[data-word="${word}"]`);
            if (wordEl) {
                wordEl.style.backgroundColor = color;
            }
        }
    }

    buttons.forEach(button => {
        button.addEventListener('click', () => {
            buttons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updateHighlight(button.dataset.head);
        });
    });

    // Initial highlight
    updateHighlight(Object.keys(attentionData)[0]);
});
</script> 